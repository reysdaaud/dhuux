"use strict";(()=>{var e={};e.id=113;e.ids=[113];e.modules={8732:e=>{e.exports=require("react/jsx-runtime")},19121:e=>{e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21271:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r);t.d(r,{POST:()=>l});var n=t(44937);var s=t.n(n);var i=t(89523);var a=t(44337);Object(function e(){var e=new Error("Cannot find module 'undici'");e.code="MODULE_NOT_FOUND";throw e}());var c=e([i,a]);[i,a]=c.then?(await c)():c;const u=[{amount:1e3,coins:100},{amount:2e3,coins:220},{amount:5e3,coins:600}];async function l(e){try{const{reference:r,userId:t}=await e.json();const o=await Object(function e(){var e=new Error("Cannot find module 'undici'");e.code="MODULE_NOT_FOUND";throw e}())(`https://api.paystack.co/transaction/verify/${r}`,{headers:{Authorization:`Bearer ${process.env.PAYSTACK_SECRET_KEY}`}});const s=await o.json();if(!s.status){return n.NextResponse.json({success:false,message:"Payment verification failed"},{status:400})}const c=s.data.amount/100;const l=u.find(e=>e.amount===c);if(!l){return n.NextResponse.json({success:false,message:"Invalid payment amount"},{status:400})}const d=(0,a.doc)(i.db,"users",t);const p=await (0,a.getDoc)(d);if(!p.exists()){return n.NextResponse.json({success:false,message:"User not found"},{status:404})}const f=p.data().coins||0;await (0,a.updateDoc)(d,{coins:f+l.coins});return n.NextResponse.json({success:true,data:{coinsAdded:l.coins,newBalance:f+l.coins}})}catch(e){console.error("Payment verification error:",e);return n.NextResponse.json({success:false,message:e.message||"Payment verification failed"},{status:500})}}o()}catch(e){o(e)}})},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},40361:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},44337:e=>{e.exports=import("firebase/firestore");},44937:e=>{e.exports=require("next/server")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66551:e=>{e.exports=import("firebase/app");},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},82015:e=>{e.exports=require("react")},86958:e=>{e.exports=import("firebase/auth");},89312:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r);t.d(r,{config:()=>d,"default":()=>u,routeModule:()=>p});var n=t(33480);var s=t.n(n);var i=t(8667);var a=t(86435);var c=t(21271);var l=e([c]);c=(l.then?(await l)():l)[0];const u=(0,a.M)(c,"default");const d=(0,a.M)(c,"config");const p=new n.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/paystack/verify/route",pathname:"/api/paystack/verify/route",bundlePath:"",filename:""},userland:c});o()}catch(e){o(e)}})},89523:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{db:()=>A});var n=t(8732);var s=t.n(n);var i=t(66551);var a=t(86958);var c=t(44337);var l=t(82015);var u=t.n(l);var d=t(95594);var p=t(69222);var f=t.n(p);var g=e([i,a,c,d]);[i,a,c,d]=g.then?(await g)():g;const h={apiKey:"AIzaSyAl1iiyOrU49GOJdezPc-6zQPeonpJxl0I",authDomain:"wirenext-b4b65.firebaseapp.com",projectId:"wirenext-b4b65",storageBucket:"wirenext-b4b65.appspot.com",messagingSenderId:"486545175288",appId:"1:486545175288:web:6d53203232567ae786810d",measurementId:"G-9H1ZKBRWK0"};let v;let m;let A;if(!(0,i.getApps)().length){v=(0,i.initializeApp)(h)}else{v=(0,i.getApps)()[0]}m=(0,a.getAuth)(v);A=(0,c.getFirestore)(v);const P=null&&createContext(undefined);const C=()=>{const e=useContext(P);if(e===undefined){throw new Error("useAuthContext must be used within an AuthProvider")}return e};const y=({children:e})=>{const[r,t]=useState(null);const[o,n]=useState(null);const[s,i]=useState(true);const[a,c]=useState(true);const[l,u]=useState(null);const d=useRouter();const p=usePathname();const f=useCallback(async e=>{if(!e){n(null);c(false);console.log("[AuthProvider] fetchUserProfile: No current user, profile set to null.");return}console.log(`[AuthProvider] fetchUserProfile: Fetching profile for user ${e.uid}`);c(true);try{const r=doc(A,"users",e.uid);const t=await getDoc(r);if(t.exists()){n(t.data());console.log("[AuthProvider] fetchUserProfile: Profile fetched successfully.",t.data())}else{n(null);console.warn("[AuthProvider] fetchUserProfile: User document not found in Firestore after initialization attempt.")}}catch(e){console.error("[AuthProvider] fetchUserProfile: Error fetching user profile:",e);u(e);n(null)}finally{c(false);console.log("[AuthProvider] fetchUserProfile: Profile fetching complete.")}},[]);const g=useCallback(async()=>{const e=m.currentUser;console.log("[AuthProvider] refreshUserProfile called.");if(e){await f(e)}else{console.log("[AuthProvider] refreshUserProfile: No current user to refresh profile for.")}},[f]);useEffect(()=>{console.log("[AuthProvider] Setting up onAuthStateChanged listener.");const e=m.onAuthStateChanged(async e=>{console.log("[AuthProvider] onAuthStateChanged triggered. Current user:",e?.uid||"None");i(true);c(true);t(e);if(e){console.log("[AuthProvider] onAuthStateChanged: User detected. Initializing and fetching profile.");try{await initializeUserInFirestore(e);await f(e)}catch(e){console.error("[AuthProvider] onAuthStateChanged: Error during user processing:",e);u(e);n(null);c(false)}}else{console.log("[AuthProvider] onAuthStateChanged: No user. Clearing profile.");n(null);c(false)}i(false);console.log("[AuthProvider] onAuthStateChanged: Auth state processing complete. Loading:",false,"isUserProfileLoading:",a)},e=>{console.error("[AuthProvider] onAuthStateChanged: Listener error:",e);u(e);t(null);n(null);i(false);c(false)});return()=>{console.log("[AuthProvider] Cleaning up onAuthStateChanged listener.");e()}},[f]);useEffect(()=>{console.log(`[AuthProvider] Redirection check. Auth Loading: ${s}, Profile Loading: ${a}, User: ${r?.uid}, Path: ${p}`);if(s||a){console.log("[AuthProvider] Redirection check: Auth or profile still loading, waiting.");return}const e=p==="/auth/signin";const t=p==="/profile/setup";const n=p==="/profile/preferences";if(r){console.log("[AuthProvider] Redirection check: User is logged in.");if(e){console.log("[AuthProvider] User logged in and on sign-in page, redirecting to /");d.replace("/");return}if(o&&!o.profileComplete&&!t&&!n){console.log("[AuthProvider] User profile not complete, redirecting to /profile/setup");d.replace("/profile/setup");return}if(o&&o.profileComplete&&(!o.preferredCategories||o.preferredCategories.length===0)&&!n){console.log("[AuthProvider] User profile complete, but no preferences. Redirecting to /profile/preferences");d.replace("/profile/preferences");return}if(o&&o.profileComplete&&t){console.log("[AuthProvider] User on setup page, but profile complete. Redirecting based on preferences.");if(!o.preferredCategories||o.preferredCategories.length===0){d.replace("/profile/preferences")}else{d.replace("/")}return}if(o&&!o.profileComplete&&n){console.log("[AuthProvider] User on preferences page, but profile incomplete. Redirecting to /profile/setup.");d.replace("/profile/setup");return}if(o&&o.profileComplete&&o.preferredCategories&&o.preferredCategories.length>0&&n){console.log("[AuthProvider] User on preferences page, but preferences already set. Redirecting to /.");d.replace("/");return}}else{console.log("[AuthProvider] Redirection check: No user logged in.");if(!e){console.log(`[AuthProvider] No user, not on auth page (current: ${p}), redirecting to /auth/signin.`);d.replace("/auth/signin")}}},[r,o,s,a,d,p]);const h=async()=>{console.log("[AuthProvider] signInWithGoogle called.");u(null);try{const e=new GoogleAuthProvider;const r=await signInWithPopup(m,e);console.log("[AuthProvider] signInWithGoogle successful for user:",r.user?.uid);return r.user}catch(e){console.error("[AuthProvider] signInWithGoogle: Error:",e);u(e);throw e}};const v=async()=>{console.log("[AuthProvider] signOutUser called.");try{await signOut(m);console.log("[AuthProvider] signOutUser successful.")}catch(e){console.error("[AuthProvider] signOutUser: Error:",e);u(e);throw e}};const C={user:r,userProfile:o,signInWithGoogle:h,signOutUser:v,loading:s,isUserProfileLoading:a,error:l,firebaseAuth:m,refreshUserProfile:g};return _jsx(P.Provider,{value:C,children:e})};o()}catch(e){o(e)}})},95594:(e,r,t)=>{t.a(e,async(e,r)=>{try{var o=t(44337);var n=t(89523);var s=e([o,n]);[o,n]=s.then?(await s)():s;const i=async e=>{if(!e){console.error("[UserManagement] User not provided for initialization.");return}try{const r=doc(db,"users",e.uid);const t=await getDoc(r);if(!t.exists()){const t=e.displayName?.split(" ")||[];const o=t[0]||"";const n=t.slice(1).join(" ")||"";await setDoc(r,{uid:e.uid,name:e.displayName||`${o} ${n}`.trim(),email:e.email,photoURL:e.photoURL,firstName:o,lastName:n,country:"",mobile:"",profileComplete:false,preferredCategories:[],isAdmin:false,coins:0,freeContentConsumedCount:0,consumedContentIds:[],likedContentIds:[],savedContentIds:[],lastLogin:serverTimestamp(),createdAt:serverTimestamp(),updatedAt:serverTimestamp()});console.log("[UserManagement] User initialized in Firestore:",e.uid)}else{const o=t.data();const n={lastLogin:serverTimestamp(),updatedAt:serverTimestamp()};if(typeof o.profileComplete==="undefined")n.profileComplete=false;if(!o.preferredCategories)n.preferredCategories=[];if(typeof o.isAdmin==="undefined")n.isAdmin=false;if(typeof o.coins==="undefined")n.coins=0;if(typeof o.freeContentConsumedCount==="undefined")n.freeContentConsumedCount=0;if(!o.consumedContentIds)n.consumedContentIds=[];if(!o.likedContentIds)n.likedContentIds=[];if(!o.savedContentIds)n.savedContentIds=[];if(Object.keys(n).length>2){await updateDoc(r,n);console.log("[UserManagement] Existing user document updated with new fields:",e.uid,n)}else{await updateDoc(r,{lastLogin:serverTimestamp(),updatedAt:serverTimestamp()})}}}catch(e){console.error("[UserManagement] Error initializing/updating user:",e)}};r()}catch(e){r(e)}})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e);var o=r.X(0,[609],()=>t(89312));module.exports=o})();