"use strict";(()=>{var e={};e.id=511;e.ids=[511];e.modules={8667:(e,t)=>{var r;r={value:true};Object.defineProperty(t,"A",{enumerable:true,get:function(){return n}});var n=function(e){e["PAGES"]="PAGES";e["PAGES_API"]="PAGES_API";e["APP_PAGE"]="APP_PAGE";e["APP_ROUTE"]="APP_ROUTE";e["IMAGE"]="IMAGE";return e}({})},9248:(e,t,r)=>{r.r(t);r.d(t,{config:()=>l,"default":()=>u,routeModule:()=>f});var n={};r.r(n);r.d(n,{"default":()=>p});var s=r(33480);var a=r(8667);var o=r(86435);const i={apiKey:"API-1922135978AHX",merchantId:"M0910161",apiUserId:"1000146",endpoint:"https://api.waafipay.net/asm",paymentMethodMWallet:"MWALLET_ACCOUNT",currency:"USD",channelName:"WEB",serviceNameTopUp:"API_PURCHASE"};function c(){const e=new Date;const t=e.getFullYear();const r=(e.getMonth()+1).toString().padStart(2,"0");const n=e.getDate().toString().padStart(2,"0");const s=e.getHours().toString().padStart(2,"0");const a=e.getMinutes().toString().padStart(2,"0");const o=e.getSeconds().toString().padStart(2,"0");const i=e.getMilliseconds().toString().padStart(3,"0");return`${t}-${r}-${n} ${s}:${a}:${o}.${i}`}async function d(e,t){const r=i;const n=Date.now().toString()+Math.random().toString().slice(2,12).replace(".","");const s=c();const a={schemaVersion:"1.0",requestId:n,timestamp:s,channelName:r.channelName,serviceName:e,serviceParams:{merchantUid:r.merchantId,apiUserId:r.apiUserId,apiKey:r.apiKey,...t}};try{const e=await fetch(r.endpoint,{method:"POST",headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify(a)});const t=await e.text();let s;try{s=JSON.parse(t)}catch(r){return{success:false,error:`Invalid JSON response. Status: ${e.status}. Response: ${t.slice(0,500)}...`}}const o=s.responseCode?.toString();const i=o==="2001";const c=o==="2003";const d=s.responseMsg?.toUpperCase()==="RCS_SUCCESS";if(i||c||d){return{success:true,message:s.responseMsg||(c?"Transaction pending confirmation.":"Transaction succeeded."),transactionId:s.params?.transactionId||s.params?.orderId||n,data:s.params,isPending:c}}else{let e="Unknown WAAFI error";if(o==="5310"){e=s.responseMsg||"RCS_USER_REJECTED";if(s.params?.description){e+=` (${s.params.description})`}}else if(s.responseMsg){e=s.responseMsg;if(s.params?.description&&e.toUpperCase()!==s.params.description.toUpperCase()){e+=` (${s.params.description})`}}else if(s.params?.description){e=s.params.description}else if(o){e=`WAAFI Error Code: ${o}`}else if(s.errorCode){e=`WAAFI Error Code: ${s.errorCode}`}return{success:false,error:e,transactionId:s.params?.transactionId||s.params?.orderId||n,data:s.params}}}catch(t){const e=t instanceof Error?t.message:"Unknown error occurred during request.";return{success:false,error:`Network or application error: ${e}`}}}async function p(e,t){if(e.method!=="POST"){t.setHeader("Allow","POST");return t.status(405).end("Method Not Allowed")}const{amount:r,phoneNumber:n,metadata:s}=e.body;if(!r||!n||!s){return t.status(400).json({success:false,message:"Missing required payment details."})}const a={paymentMethod:i.paymentMethodMWallet,payerInfo:{accountNo:n},transactionInfo:{referenceId:`REF${Date.now().toString().slice(-7)}`,invoiceId:`INV${Date.now().toString().slice(-5)}`,amount:r.toString(),currency:i.currency,description:"test"}};const o=await d(i.serviceNameTopUp,a);if(o.success){return t.status(200).json({success:true,message:o.message,transactionId:o.transactionId,data:o.data,isPending:o.isPending})}else{return t.status(500).json({success:false,message:o.error,data:o.data})}};const u=(0,o.M)(n,"default");const l=(0,o.M)(n,"config");const f=new s.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/waafi/initiate",pathname:"/api/waafi/initiate",bundlePath:"",filename:""},userland:n})},33480:(e,t,r)=>{if(false){}else{if(false){}else if(false){}else{e.exports=r(75600)}}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{var r;r={value:true};Object.defineProperty(t,"M",{enumerable:true,get:function(){return n}});function n(e,t){if(t in e){return e[t]}if("then"in e&&typeof e.then==="function"){return e.then(e=>n(e,t))}if(typeof e==="function"&&t==="default"){return e}return undefined}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e);var n=r(9248);module.exports=n})();